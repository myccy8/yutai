<div class="row-fluid" id="contentwrapper">
    <table class="deviceTable" cellspacing="0" cellpadding="0">
        <thead>
            <tr style="border:0px" id="_goldTemplete"></tr>
            <tr class="devicetTitle">
                <!--<th class="userAccount" width="25%">ID</th>-->
                <th class="deviceNum" width="5%">商品图片</th>
                <th class="userAccount">商品名称</th>
                <th class="power">商品Url</th>
                <th class="power" width="20%">操作</th>
            </tr>
        </thead>
        <tbody id="_sgoodslisttmp"></tbody>
    </table>
    <div class="mt20">
        <input type="button" class="saveBtn" id="btnAdd" value="添加" />
    </div>
</div>
<script type="text/x-jquery-tmpl" id="sgoodslisttmp">  
        {{each Data}}
        <tr class="deviceContent canclick">
            <td class="deviceContent notice" goodsid="{{$value.goodsID}}">
                <a class="cbox_single thumbnail cboxElement">
                    <img alt="" src="{{$value.goodsImage}}" style="height:70px;width:80px">
                </a>
            </td>
            <!--<td class="deviceContent notice" newsid="{{$value.NewId}}"><img style="width:100px;height:100px" src="{{$value.NewImg}}" /></td>-->
            <td class="deviceContent notice deviceNum " width="20%" goodsid="{{$value.goodsID}}">{{$value.goodsName}}</td>
            <td class="deviceContent notice" goodsid="{{$value.goodsID}}">{{$value.goodsURL}}</td>
            <td width="20%">
                <input type="button" value="编辑" class="editorRole" goodsid="{{$value.goodsID}}">&nbsp;&nbsp;&nbsp;&nbsp;
                <input type="button" value="删除" class="deleteRole" goodsid="{{$value.goodsID}}">
            </td>
        </tr>
      {{/each}}
    <div id="pagediv"></div>
</script>

<script type="text/x-jquery-tmpl" id="goldTemplete">
    <th>
        <div class="news-name formfile-label" style=" margin-bottom: -10px; ">选择二级菜单</div>
        <select class="NewSelect" name="secondSelect" id="secondSelect" onchange="loadGoodslist()">
            {{if Total==0}}
            <option value="-1">选择二级菜单</option>
            {{/if}}
            {{each Data}}
            <option value="{{$value.secondaryNavigationID}}">{{$value.secondaryNavigationName}}</option>
            {{/each}}
        </select>
    </th>
</script>
<script type="text/javascript">
    $(function () {
        loadlist();
        $("#btnAdd").click(function () {
            loadpage("/html/GoldGuide/GoldGuideGoodsAdd.html");
        });
    });
    function loadlist() {
        $.fspost('/api/GoldGuideSecondaryNavigation/GoodsNavList', {
                PageIndex: 0,// $.cookie('pageindex')
                PageSize: 0,
            }).success(function (data) {
                $('#_goldTemplete').html(template('goldTemplete', data));
                loadGoodslist();
            });
    }
    function loadGoodslist() {
        if ($("#secondSelect").val() != "-1") {
            $.fspost('/api/GoldGuideSecondaryNavigation/GetGuideGoodsList', {
                PageIndex: $.cookie('pageindex'),// $.cookie('pageindex')
                PageSize: $.PageSize,
                SecondaryNavigationID: $("#secondSelect").val()
            }).success(function (data) {
                $.cookie('total', data.Total);
                $('#_sgoodslisttmp').html(template('sgoodslisttmp', data));
                BindClickBtn();
            });
        }
    }
    //绑定ClickBtn事件
    function BindClickBtn() {

        $(".editorRole").click(function () {
            var pageUrl = "/html/GoldGuide/GoldGuideGoodsUpdate.html?goodsid=" + $(this).attr("goodsid");
            $.cookie('pageurl', pageUrl);
            $.cookie('updateSelect', $("#secondSelect").val());
            loadpage(pageUrl);
        });
        $(".deleteRole").click(function () {
            var that = $(this);
            var request = {
                GoodsId: $(this).attr("goodsid"),
                SecondaryNavigationID: $("#secondSelect").val()
            }
            if (confirm("确定要删除?")) {
                $.ajax({
                    url: '/api/GoldGuideSecondaryNavigation/GoodsDelete',
                    type: 'Post',
                    data: JSON.stringify(request),
                    contentType: "application/json;charset=utf-8",
                    statusCode: {
                        200: function (data) {
                            debugger;
                            that.parent().parent().remove();
                        }, 401: function (jqXHR, textStatus, errorThrown) {
                            window.location.href = '/html/login.html';
                        }
                    }
                });
            }
        });

    }
</script>